<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Mood Boutique | Ropa en Tendencia para Mujer</title>
    <meta name="description" content="Descubre lo √∫ltimo en moda femenina en Mood Boutique. Corsets, vestidos, tops y accesorios con estilo. Env√≠os a todo el Per√∫.">
    <meta name="keywords" content="moda, ropa mujer, boutique peru, corsets, vestidos, tops, mood boutique, tendencia, gamarra, lima">
    <meta name="author" content="Mood Boutique">
    
    <meta property="og:title" content="Mood Boutique üçí | Cat√°logo">
    <meta property="og:description" content="¬°Descuento especial por compras mayores a S/100! Mira nuestro cat√°logo aqu√≠.">
    <meta property="og:image" content="https://placehold.co/600x400/C2185B/white?text=Mood+Boutique">
    <meta property="og:type" content="website">

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --color-bg: #FFF5F7;
            --color-card: #FFFFFF;
            --color-primary: #C2185B; /* Color Cereza */
            --color-text: #333333;
            --color-gold: #FFD700;
        }

        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding-bottom: 120px;
            min-height: 100vh;
            display: flex; flex-direction: column;
        }

        /* --- HEADER --- */
        header {
            background: white; padding: 15px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100;
            display: flex; flex-direction: column; align-items: center;
        }
        
        .nav-top { 
            width: 100%; display: flex; justify-content: space-between; align-items: center; 
            padding: 0 10px; position: relative; max-width: 1200px;
        }

        .brand-container { text-align: center; flex-grow: 1; }
        .brand-name { font-family: 'Playfair Display', serif; color: var(--color-primary); font-size: 1.8rem; font-weight: 700; line-height: 1; }
        .brand-subtitle { font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; color: #999; margin-top: 3px; }

        .menu-toggle { font-size: 1.5rem; color: var(--color-primary); cursor: pointer; position: absolute; right: 20px; }
        
        /* Men√∫ Desplegable */
        .nav-menu {
            display: none; width: 100%; flex-direction: column; gap: 15px; text-align: center;
            padding: 20px 0; border-top: 1px solid #f0f0f0; margin-top: 15px; background: white;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown { from { opacity:0; transform: translateY(-10px); } to { opacity:1; transform: translateY(0); } }
        
        .nav-menu.active { display: flex; }
        .nav-link { text-decoration: none; color: #666; font-weight: 700; font-size: 0.9rem; text-transform: uppercase; transition: 0.3s; }
        .nav-link:hover { color: var(--color-primary); }

        @media (min-width: 768px) {
            .menu-toggle { display: none; }
            .nav-menu { display: flex; flex-direction: row; justify-content: center; border: none; gap: 30px; margin-top: 10px; }
        }

        /* --- HERO BANNER INTELIGENTE --- */
        #hero-wrapper {
            position: relative; width: 100%; 
            background: #eee; margin-bottom: 20px;
            overflow: hidden;
        }

        /* Estilos Comunes de Slide */
        .hero-slide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; transition: opacity 1s ease-in-out; cursor: pointer;
            display: flex; /* Para Desktop Grid */
        }
        .hero-slide.active { opacity: 1; z-index: 2; }

        /* M√ìVIL (Por defecto) */
        #hero-wrapper { height: 400px; }
        .hero-mobile { display: block; height: 100%; width: 100%; }
        .hero-desktop { display: none; }

        .hero-img-single { width: 100%; height: 100%; object-fit: cover; object-position: top center; }
        
        .hero-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(194, 24, 91, 0.9), transparent);
            padding: 30px 20px 20px 20px; color: white;
            display: flex; flex-direction: column; justify-content: flex-end; text-align: center;
        }
        .hero-tag { background: var(--color-gold); color: #333; font-size: 0.7rem; font-weight: bold; padding: 5px 10px; border-radius: 15px; align-self: center; margin-bottom: 10px; text-transform: uppercase; }
        .hero-title { font-family: 'Playfair Display', serif; font-size: 2rem; margin-bottom: 5px; text-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .hero-price { font-size: 1.2rem; font-weight: bold; }

        /* LAPTOP / DESKTOP (Grid de 3) */
        @media (min-width: 768px) {
            #hero-wrapper { height: 500px; border-radius: 0 0 20px 20px; }
            .hero-mobile { display: none; }
            .hero-desktop { display: block; height: 100%; width: 100%; position: relative; }
            
            /* Cada item dentro del slide de desktop (1/3 del ancho) */
            .hero-desktop-item {
                width: 33.333%;
                height: 100%;
                position: relative;
                border-right: 1px solid rgba(255,255,255,0.2);
                overflow: hidden;
            }
            .hero-desktop-item:last-child { border-right: none; }
            
            .hero-desktop-item img {
                width: 100%; height: 100%; object-fit: cover;
                transition: transform 0.5s;
            }
            .hero-desktop-item:hover img { transform: scale(1.05); }

            /* Overlay interno m√°s peque√±o para desktop */
            .hero-overlay-mini {
                position: absolute; bottom: 0; left: 0; width: 100%;
                background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
                padding: 20px; color: white; text-align: center;
                transform: translateY(10px); transition: 0.3s;
            }
            .hero-desktop-item:hover .hero-overlay-mini { transform: translateY(0); }
            
            .mini-tag { font-size: 0.6rem; background: var(--color-primary); padding: 3px 8px; border-radius: 4px; text-transform: uppercase; margin-bottom: 5px; display: inline-block; }
            .mini-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 5px; }
        }

        /* --- NOVEDADES --- */
        .featured-section { padding: 20px; background: white; margin-bottom: 20px; }
        .section-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; color: var(--color-primary); text-align: center; margin-bottom: 20px; }
        
        .featured-grid { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; justify-content: flex-start; }
        .featured-grid::-webkit-scrollbar { display: none; }
        
        .featured-card { 
            min-width: 140px; background: white; border-radius: 10px; overflow: hidden; 
            border: 1px solid #f0f0f0; position: relative; transition: transform 0.3s;
        }
        .featured-card:hover { transform: translateY(-5px); }
        .featured-badge { position: absolute; top: 5px; left: 5px; background: var(--color-primary); color: white; padding: 3px 8px; font-size: 0.7rem; border-radius: 5px; font-weight: bold; z-index: 2; }
        .featured-img { width: 100%; height: 160px; object-fit: cover; }
        .featured-info { padding: 8px; text-align: center; }
        .featured-name { font-size: 0.8rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .featured-price { color: var(--color-primary); font-size: 0.9rem; font-weight: bold; }

        @media (min-width: 768px) {
            .featured-grid { justify-content: center; overflow-x: visible; flex-wrap: wrap; gap: 30px; }
            .featured-card { min-width: 240px; max-width: 240px; }
            .featured-img { height: 300px; }
            .featured-info { padding: 15px; }
            .featured-name { font-size: 1rem; }
        }

        /* --- CAT√ÅLOGO --- */
        #main-container { max-width: 1200px; margin: 0 auto; flex-grow: 1; }
        .category-section { padding: 20px 10px; }
        .category-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--color-primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; padding: 0 10px; }
        .category-title::after { content: ''; flex-grow: 1; height: 1px; background: #ffcfe0; }
        
        .product-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 0 10px; }
        
        .product-card { background: var(--color-card); border-radius: 12px; width: 100%; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; position: relative; }
        .product-img-container { height: 250px; width: 100%; position: relative; overflow: hidden; }
        .product-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .product-card:hover .product-img { transform: scale(1.05); }
        .product-info { padding: 12px; display: flex; flex-direction: column; }
        .product-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-price { color: var(--color-primary); font-weight: bold; font-size: 1.1rem; }
        .card-qty-badge { position: absolute; top: 10px; right: 10px; background: var(--color-primary); color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.85rem; font-weight: bold; display: none; z-index: 10; }
        .product-card.has-qty .card-qty-badge { display: block; }
        .product-card.has-qty { border: 2px solid var(--color-primary); }

        @media (min-width: 768px) {
            .product-gallery { grid-template-columns: repeat(3, 1fr); gap: 30px; }
            .product-img-container { height: 350px; }
        }

        /* --- TESTIMONIOS --- */
        .testi-section { background: #FFF0F5; padding: 40px 20px; margin-top: 20px; }
        .testimonials-wrapper { position: relative; width: 100%; max-width: 800px; margin: 0 auto; min-height: 250px; }
        .testi-card { background: white; border-radius: 15px; padding: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: absolute; width: 100%; opacity: 0; transition: opacity 0.5s ease-in-out; pointer-events: none; }
        .testi-card.active { opacity: 1; pointer-events: all; position: relative; }
        .testi-text { font-style: italic; color: #555; font-size: 1rem; margin-bottom: 15px; }
        .testi-author { font-weight: 700; color: var(--color-primary); text-transform: uppercase; font-size: 0.9rem; }
        .stars { color: var(--color-gold); margin-bottom: 10px; }

        /* --- SOBRE NOSOTROS --- */
        .about-section { background: white; padding: 50px 20px; }
        .about-container { display: flex; flex-direction: column; gap: 30px; align-items: center; max-width: 1000px; margin: 0 auto; }
        .about-img { width: 100%; border-radius: 20px; height: 300px; object-fit: cover; }
        .about-txt { text-align: center; line-height: 1.8; color: #555; }
        @media (min-width: 768px) {
            .about-container { flex-direction: row; gap: 50px; }
            .about-img { width: 50%; height: 400px; } 
            .about-txt { width: 50%; padding: 0 20px; text-align: left; font-size: 1.1rem; }
        }

        /* --- FOOTER --- */
        .app-footer { background: #333; color: white; padding: 40px 20px; text-align: center; margin-top: 0; }
        .footer-logo { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-bottom: 20px; }
        .social-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .social-btn { width: 45px; height: 45px; border-radius: 50%; background: rgba(255,255,255,0.1); color: white; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 1.4rem; transition: 0.3s; }
        .social-btn:hover { background: var(--color-primary); transform: translateY(-3px); }
        .footer-copy { font-size: 0.8rem; color: #999; }

        /* --- MODALES & CARRITO --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 400px; border-radius: 20px; overflow: hidden; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-img { width: 100%; height: 300px; object-fit: cover; }
        .modal-details { padding: 20px; text-align: center; }
        .close-modal-btn { position: absolute; top: 15px; right: 15px; background: white; width: 35px; height: 35px; border-radius: 50%; border: none; font-size: 1.2rem; cursor: pointer; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .qty-control-wrapper { display: flex; align-items: center; justify-content: center; gap: 20px; margin-top: 20px; background: #FFF5F7; padding: 10px; border-radius: 15px; }
        .btn-qty { width: 40px; height: 40px; border-radius: 50%; border: none; background: white; color: var(--color-primary); font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; }
        .qty-display { font-size: 1.5rem; font-weight: bold; color: #333; min-width: 30px; }
        @media (min-width: 768px) { .modal-content { display: flex; max-width: 700px; height: 400px; } .modal-img { width: 50%; height: 100%; } .modal-details { width: 50%; display: flex; flex-direction: column; justify-content: center; } }

        .bottom-cart-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(150%); width: 90%; max-width: 500px; background: var(--color-primary); color: white; border-radius: 20px; box-shadow: 0 5px 20px rgba(194, 24, 91, 0.4); display: flex; flex-direction: column; overflow: hidden; z-index: 1500; transition: transform 0.4s; cursor: pointer; }
        .bottom-cart-bar.visible { transform: translateX(-50%) translateY(0); }
        .cart-content-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; width: 100%; }
        .progress-wrapper { background: rgba(0,0,0,0.2); width: 100%; height: 24px; display: flex; align-items: center; justify-content: center; position: relative; }
        .progress-fill { position: absolute; left: 0; top: 0; height: 100%; background: #FF80AB; width: 0%; transition: width 0.5s ease; }
        .progress-text { font-size: 0.75rem; font-weight: bold; z-index: 2; text-transform: uppercase; letter-spacing: 0.5px; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .bottom-cart-bar.discount-unlocked { background: linear-gradient(135deg, #C2185B 0%, #880E4F 100%); border: 2px solid var(--color-gold); }
        .bottom-cart-bar.discount-unlocked .progress-fill { background: var(--color-gold); }
        .old-price { font-size: 0.8rem; text-decoration: line-through; opacity: 0.7; margin-right: 5px; }
    </style>
</head>
<body>

    <header id="inicio">
        <div class="nav-top">
            <div class="brand-container">
                <div class="brand-name">Mood Boutique üçí</div>
                <div class="brand-subtitle">Viste tu mejor versi√≥n</div>
            </div>
            <i class="fas fa-bars menu-toggle" onclick="toggleMenu()"></i>
        </div>
        <nav class="nav-menu" id="navMenu">
            <a href="#inicio" class="nav-link" onclick="toggleMenu()">Inicio</a>
            <a href="#catalogo" class="nav-link" onclick="toggleMenu()">Cat√°logo</a>
            <a href="#testimonios" class="nav-link" onclick="toggleMenu()">Clientas</a>
            <a href="#nosotros" class="nav-link" onclick="toggleMenu()">Nosotros</a>
            <a href="#contacto" class="nav-link" onclick="toggleMenu()">Contacto</a>
        </nav>
    </header>

    <div id="hero-wrapper">
        </div>

    <div class="featured-section">
        <h2 class="section-title">Novedades üî•</h2>
        <div class="featured-grid" id="featuredGrid"></div>
    </div>

    <div id="main-container">
        <div id="catalogo">
            <div style="text-align:center; padding:50px;">
                <i class="fas fa-spinner fa-spin" style="font-size:2rem; color:var(--color-primary);"></i>
                <p style="margin-top:10px;">Cargando cat√°logo...</p>
            </div>
        </div>
    </div>

    <section id="testimonios" class="testi-section">
        <h2 class="section-title">Mood Lovers üíï</h2>
        <div class="testimonials-wrapper">
            <div class="testi-card active">
                <div class="stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                <div class="testi-text">"Am√© mi corset, la tela es s√∫per buena y me qued√≥ perfecto. El env√≠o a Los Olivos fue rapid√≠simo."</div>
                <div class="testi-author">Andrea M.</div>
            </div>
            <div class="testi-card">
                <div class="stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                <div class="testi-text">"Los vestidos son hermosos, id√©nticos a las fotos. Definitivamente volver√© a comprar."</div>
                <div class="testi-author">Valeria S.</div>
            </div>
            <div class="testi-card">
                <div class="stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                <div class="testi-text">"Me encanta que tengan tallas reales y colores variados. ¬°S√∫per recomendado!"</div>
                <div class="testi-author">Camila R.</div>
            </div>
        </div>
    </section>

    <section id="nosotros" class="about-section">
        <div class="about-container">
            <img src="https://images.unsplash.com/photo-1441984904996-e0b6ba687e04?auto=format&fit=crop&w=800&q=80" class="about-img">
            <div class="about-txt">
                <h2 class="section-title" style="text-align: left;">Nuestra Esencia</h2>
                <p>En <strong>Mood Boutique</strong>, creemos que la moda es una forma de expresar qui√©n eres. Nacimos con la misi√≥n de ofrecer prendas en tendencia que te hagan sentir segura, c√≥moda y empoderada.</p>
                <br>
                <p>Seleccionamos cuidadosamente cada tela y dise√±o, inspir√°ndonos en lo √∫ltimo de la moda global pero adapt√°ndolo al estilo √∫nico de la mujer peruana. ¬°Gracias por dejarnos ser parte de tu outfit!</p>
            </div>
        </div>
    </section>

    <footer id="contacto" class="app-footer">
        <div class="footer-logo">Mood Boutique</div>
        <div class="social-links">
            <a href="https://www.instagram.com/mood.boutique.pe" target="_blank" class="social-btn"><i class="fab fa-instagram"></i></a>
            <a href="https://www.tiktok.com/@mood.boutiquepe" target="_blank" class="social-btn"><i class="fab fa-tiktok"></i></a>
            <a href="https://wa.me/51924931258" target="_blank" class="social-btn"><i class="fab fa-whatsapp"></i></a>
        </div>
        <p class="footer-copy">¬© 2026 Mood Boutique Per√∫.<br>Dise√±ado para brillar.</p>
    </footer>

    <div class="modal-overlay" id="productModal" onclick="closeModal(event)">
        <div class="modal-content">
            <button class="close-modal-btn" onclick="closeModal(null)">&times;</button>
            <img src="" class="modal-img" id="modalImg">
            <div class="modal-details">
                <h2 id="modalTitle" style="font-family: 'Playfair Display', serif; margin-bottom:5px;"></h2>
                <h3 id="modalPrice" style="color:var(--color-primary); font-size:1.5rem; margin-bottom:10px;"></h3>
                <p id="modalDesc" style="color:#666; font-size:0.9rem; margin-bottom:15px;"></p>
                <p style="font-size:0.8rem; font-weight:bold; color:#888; margin-top:10px;">CANTIDAD:</p>
                <div class="qty-control-wrapper">
                    <button class="btn-qty" onclick="adjustQty(-1)"><i class="fas fa-minus"></i></button>
                    <span class="qty-display" id="modalQtyDisplay">0</span>
                    <button class="btn-qty" onclick="adjustQty(1)"><i class="fas fa-plus"></i></button>
                </div>
                <div style="margin-top:15px; font-size:0.8rem; color:#C2185B;" id="modalTotalLabel"></div>
            </div>
        </div>
    </div>

    <div class="bottom-cart-bar" id="cartBar" onclick="sendToWhatsapp()">
        <div class="progress-wrapper">
            <div class="progress-fill" id="progressFill"></div>
            <div class="progress-text" id="progressText">Faltan S/50 para 10% OFF</div>
        </div>
        <div class="cart-content-row">
            <div style="display:flex; align-items:center; gap:10px;">
                <i class="fas fa-shopping-bag"></i>
                <span style="font-weight:bold;"><span id="cartCount">0</span> items</span>
            </div>
            <div style="font-weight:bold; display:flex; flex-direction:column; align-items:flex-end;">
                <span id="oldPriceDisplay" class="old-price" style="display:none;"></span>
                <span>S/ <span id="cartTotal">0.00</span> <i class="fas fa-chevron-right" style="font-size:0.8rem; margin-left:5px;"></i></span>
            </div>
        </div>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQq_UOdhkllOrtOhnsLtQPDJ-zNi-cCQd1GkPw7sNq8ixu5fMV0zEcUuknPmlo6ksJiwEAJwOAarmW7/pub?output=csv'; 
        const PHONE_NUMBER = '51924931258';
        const DISCOUNT_THRESHOLD = 100; 
        const DISCOUNT_RATE = 0.10; 

        let products = [];
        let cart = {}; 
        let currentModalProductId = null;

        async function init() {
            try {
                const res = await fetch(SHEET_URL);
                const text = await res.text();
                products = parseCSV(text);
                renderHero(); 
                renderFeatured(); 
                renderApp();  
            } catch (error) {
                products = getMockData(); 
                renderHero();
                renderFeatured();
                renderApp();
            }
            initTestimonials(); 
        }

        function toggleMenu() { document.getElementById('navMenu').classList.toggle('active'); }
        
        function initTestimonials() {
            const slides = document.querySelectorAll('.testi-card');
            if (slides.length === 0) return;
            let index = 0;
            setInterval(() => {
                slides[index].classList.remove('active');
                index = (index + 1) % slides.length;
                slides[index].classList.add('active');
            }, 5000);
        }

        // --- RENDER HERO RESPONSIVE ---
        function renderHero() {
            const wrapper = document.getElementById('hero-wrapper');
            // Usamos los 6 productos m√°s recientes para el banner
            const topProducts = products.slice(0, 6);
            if(topProducts.length === 0) { wrapper.style.display = 'none'; return; }

            // 1. Mobile HTML (1 item per slide)
            let mobileHTML = '<div class="hero-mobile">';
            topProducts.forEach((prod, i) => {
                mobileHTML += `
                    <div class="hero-slide ${i === 0 ? 'active' : ''}" id="m-slide-${i}" onclick="openModalById('${prod.id}')">
                        <img src="${fixDriveLink(prod.image)}" class="hero-img-single">
                        <div class="hero-overlay">
                            <span class="hero-tag">Trending üî•</span>
                            <h2 class="hero-title">${prod.name}</h2>
                            <div class="hero-price">S/ ${prod.price}</div>
                        </div>
                    </div>`;
            });
            mobileHTML += '</div>';

            // 2. Desktop HTML (3 items per slide -> Groups of 3)
            let desktopHTML = '<div class="hero-desktop">';
            // Agrupamos de 3 en 3
            for (let i = 0; i < topProducts.length; i += 3) {
                const chunk = topProducts.slice(i, i + 3);
                desktopHTML += `<div class="hero-slide ${i === 0 ? 'active' : ''}" id="d-slide-${i/3}">`;
                
                chunk.forEach(prod => {
                    desktopHTML += `
                        <div class="hero-desktop-item" onclick="openModalById('${prod.id}')">
                            <img src="${fixDriveLink(prod.image)}">
                            <div class="hero-overlay-mini">
                                <span class="mini-tag">NUEVO</span>
                                <div class="mini-title">${prod.name}</div>
                                <div>S/ ${prod.price}</div>
                            </div>
                        </div>`;
                });
                desktopHTML += `</div>`;
            }
            desktopHTML += '</div>';

            wrapper.innerHTML = mobileHTML + desktopHTML;

            // Iniciar animaciones separadas
            startHeroAnimation('m-slide-', topProducts.length);
            startHeroAnimation('d-slide-', Math.ceil(topProducts.length / 3));
        }

        function startHeroAnimation(prefix, count) {
            if(count <= 1) return;
            let current = 0;
            setInterval(() => {
                const prevEl = document.getElementById(prefix + current);
                if(prevEl) prevEl.classList.remove('active');
                
                current = (current + 1) % count;
                
                const nextEl = document.getElementById(prefix + current);
                if(nextEl) nextEl.classList.add('active');
            }, 4000);
        }

        function renderFeatured() {
            const featContainer = document.getElementById('featuredGrid');
            const featProducts = products.slice(-6).reverse(); 
            featContainer.innerHTML = featProducts.map(prod => `
                <div class="featured-card" onclick="openModalById('${prod.id}')">
                    <div class="featured-badge">NEW</div>
                    <img src="${fixDriveLink(prod.image)}" class="featured-img" loading="lazy">
                    <div class="featured-info">
                        <div class="featured-name">${prod.name}</div>
                        <div class="featured-price">S/ ${prod.price}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderApp() {
            const container = document.getElementById('catalogo');
            container.innerHTML = ''; 
            const categories = [...new Set(products.map(p => p.category))];

            categories.forEach(cat => {
                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `<h2 class="category-title">${cat}</h2>`;
                const gallery = document.createElement('div');
                gallery.className = 'product-gallery';

                products.filter(p => p.category === cat).forEach(prod => {
                    const qty = cart[prod.id] || 0;
                    const card = document.createElement('div');
                    card.className = `product-card ${qty > 0 ? 'has-qty' : ''}`;
                    card.id = `card-${prod.id}`;
                    card.onclick = () => openModal(prod);

                    card.innerHTML = `
                        <div class="product-img-container">
                            <div class="card-qty-badge" id="badge-${prod.id}">x${qty}</div>
                            <img src="${fixDriveLink(prod.image)}" class="product-img" loading="lazy">
                        </div>
                        <div class="product-info">
                            <div class="product-title">${prod.name}</div>
                            <div class="product-price">S/ ${prod.price}</div>
                        </div>
                    `;
                    gallery.appendChild(card);
                });
                section.appendChild(gallery);
                container.appendChild(section);
            });
        }

        function openModalById(id) {
            const prod = products.find(p => p.id === id);
            if(prod) openModal(prod);
        }

        function openModal(product) {
            currentModalProductId = product.id;
            const modal = document.getElementById('productModal');
            document.getElementById('modalImg').src = fixDriveLink(product.image);
            document.getElementById('modalTitle').innerText = product.name;
            document.getElementById('modalPrice').innerText = `S/ ${product.price}`;
            document.getElementById('modalDesc').innerText = `${product.sizes ? 'Tallas: ' + product.sizes : ''}`;
            updateModalControls();
            modal.style.display = 'flex';
        }

        function closeModal(e) {
            if (!e || e.target.id === 'productModal') {
                document.getElementById('productModal').style.display = 'none';
            }
        }

        function updateModalControls() {
            const qty = cart[currentModalProductId] || 0;
            document.getElementById('modalQtyDisplay').innerText = qty;
            const product = products.find(p => p.id === currentModalProductId);
            if(product && qty > 0) {
                document.getElementById('modalTotalLabel').innerText = `Subtotal: S/ ${(product.price * qty).toFixed(2)}`;
            } else {
                document.getElementById('modalTotalLabel').innerText = "Selecciona cantidad";
            }
        }

        function adjustQty(change) {
            const id = currentModalProductId;
            if (!cart[id]) cart[id] = 0;
            cart[id] += change;
            if (cart[id] <= 0) delete cart[id];
            updateModalControls();
            updateCardBadge(id);
            updateBottomBar();
        }

        function updateCardBadge(id) {
            const qty = cart[id] || 0;
            const card = document.getElementById(`card-${id}`);
            const badge = document.getElementById(`badge-${id}`);
            if (card && badge) {
                badge.innerText = `x${qty}`;
                if (qty > 0) card.classList.add('has-qty');
                else card.classList.remove('has-qty');
            }
        }

        function updateBottomBar() {
            const bar = document.getElementById('cartBar');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const oldPriceDisplay = document.getElementById('oldPriceDisplay');
            const cartTotal = document.getElementById('cartTotal');
            const cartCount = document.getElementById('cartCount');
            
            let subtotal = 0;
            let totalItems = 0;
            for (const [id, qty] of Object.entries(cart)) {
                const p = products.find(x => x.id === id);
                if (p) { subtotal += p.price * qty; totalItems += qty; }
            }

            let percentage = (subtotal / DISCOUNT_THRESHOLD) * 100;
            if (percentage > 100) percentage = 100;
            progressFill.style.width = `${percentage}%`;

            if (subtotal < DISCOUNT_THRESHOLD) {
                let remaining = DISCOUNT_THRESHOLD - subtotal;
                progressText.innerText = `Faltan S/${remaining.toFixed(2)} para 10% OFF`;
                bar.classList.remove('discount-unlocked');
                oldPriceDisplay.style.display = 'none';
                cartTotal.innerText = subtotal.toFixed(2);
            } else {
                progressText.innerText = "¬°Descuento 10% Desbloqueado! üéâ";
                bar.classList.add('discount-unlocked');
                let discountAmount = subtotal * DISCOUNT_RATE;
                let finalTotal = subtotal - discountAmount;
                oldPriceDisplay.style.display = 'inline';
                oldPriceDisplay.innerText = `S/ ${subtotal.toFixed(2)}`;
                cartTotal.innerText = finalTotal.toFixed(2);
            }
            cartCount.innerText = totalItems;
            if (totalItems > 0) bar.classList.add('visible');
            else bar.classList.remove('visible');
        }

        function sendToWhatsapp() {
            if (Object.keys(cart).length === 0) return;
            let msg = "Hola Mood Boutique üçí, este es mi pedido:%0A%0A";
            let subtotal = 0;
            for (const [id, qty] of Object.entries(cart)) {
                const p = products.find(x => x.id === id);
                if (p) {
                    const itemTotal = p.price * qty;
                    msg += `- ${p.name} (x${qty}) S/ ${itemTotal.toFixed(2)}%0A`;
                    subtotal += itemTotal;
                }
            }
            msg += `%0A----------------`;
            if (subtotal >= DISCOUNT_THRESHOLD) {
                let discount = subtotal * DISCOUNT_RATE;
                let total = subtotal - discount;
                msg += `%0ASubtotal: S/ ${subtotal.toFixed(2)}`;
                msg += `%0AüéÅ Descuento (10%): - S/ ${discount.toFixed(2)}`;
                msg += `%0A*TOTAL FINAL: S/ ${total.toFixed(2)}*`;
            } else {
                msg += `%0A*Total: S/ ${subtotal.toFixed(2)}*`;
            }
            window.open(`https://wa.me/${PHONE_NUMBER}?text=${msg}`, '_blank');
        }

        function fixDriveLink(url) {
            if (!url) return 'https://placehold.co/400x500/ffe4e1/C2185B?text=Mood+Boutique';
            if (url.includes('drive.google.com') && url.includes('/d/')) {
                const id = url.split('/d/')[1].split('/')[0];
                return `https://wsrv.nl/?url=${encodeURIComponent('https://drive.google.com/uc?export=view&id=' + id)}&w=500&q=80`;
            }
            return `https://wsrv.nl/?url=${encodeURIComponent(url)}&w=500`;
        }

        function parseCSV(csv) {
            const lines = csv.split('\n').slice(1);
            return lines.map(line => {
                const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (parts.length < 4) return null;
                return {
                    id: parts[0].trim(),
                    name: parts[1].replace(/"/g, '').trim(),
                    category: parts[2].trim(),
                    price: parseFloat(parts[3]),
                    sizes: parts[4] ? parts[4].replace(/"/g, '') : '',
                    colors: parts[5] ? parts[5].replace(/"/g, '') : '',
                    image: parts[6] ? parts[6].trim() : ''
                };
            }).filter(p => p !== null);
        }

        function getMockData() {
            return [
                {id: '1', name: 'Corset B√°sico', category: 'Tops', price: 40, sizes: 'S, M', image: ''},
                {id: '2', name: 'Set Paloma', category: 'Vestidos', price: 65, sizes: 'Standard', image: ''},
                {id: '3', name: 'Top Encaje', category: 'Tops', price: 35, sizes: 'S, M', image: ''},
                {id: '4', name: 'Jean Wide', category: 'Pantalones', price: 60, sizes: '28, 30', image: ''},
                {id: '5', name: 'Falda Cuero', category: 'Faldas', price: 35, sizes: 'S, M', image: ''},
                {id: '6', name: 'Blazer', category: 'Chaquetas', price: 70, sizes: 'S', image: ''}
            ];
        }

        init();
    </script>
</body>
</html>
